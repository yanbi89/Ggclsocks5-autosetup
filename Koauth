#!/bin/bash

# ===== Cáº¤U HÃŒNH =====
PORT=443

# Láº¥y interface máº¡ng chÃ­nh
INTERFACE=$(ip route get 1 | awk '{print $5; exit}')
IP=$(curl -s https://api.ipify.org)

# ===== CÃ€I GÃ“I =====
apt update
apt install -y curl dante-server

# ===== Cáº¤U HÃŒNH DANTED (NO AUTH) =====
cat <<EOF > /etc/danted.conf
logoutput: /var/log/danted.log

internal: 0.0.0.0 port = $PORT
external: $INTERFACE

# Táº®T XÃC THá»°C
method: none
socksmethod: none

user.privileged: root
user.notprivileged: nobody
user.libwrap: nobody

client pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
  log: connect disconnect
}

socks pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
  command: connect
  log: connect disconnect
}
EOF

# ===== Má»ž Cá»”NG =====
if command -v ufw &>/dev/null; then
  ufw allow $PORT/tcp
else
  iptables -C INPUT -p tcp --dport $PORT -j ACCEPT 2>/dev/null || \
  iptables -I INPUT -p tcp --dport $PORT -j ACCEPT
fi

# ===== KHá»žI Äá»˜NG =====
systemctl restart danted
systemctl enable danted

# ===== HIá»‚N THá»Š PROXY =====
PROXY="$IP:$PORT"
echo
echo "âœ… SOCKS5 NO-AUTH Ä‘Ã£ cÃ i xong!"
echo "ðŸ“Œ Proxy (IP:PORT): $PROXY"
echo "$PROXY" > /root/socks5_noauth_proxy.txt
