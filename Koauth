#!/bin/bash

# ===== C·∫§U H√åNH =====
PORT=443
IP=$(curl -s https://api.ipify.org)

# ===== C√ÄI ƒê·∫∂T =====
apt update
apt install -y squid curl

# ===== BACKUP CONFIG C≈® =====
if [ -f /etc/squid/squid.conf ]; then
  mv /etc/squid/squid.conf /etc/squid/squid.conf.bak
fi

# ===== T·∫†O CONFIG NO-AUTH =====
cat <<EOF > /etc/squid/squid.conf
http_port $PORT

# Cho ph√©p t·∫•t c·∫£ (NO AUTH)
acl all src all
http_access allow all

# ·∫®n header proxy
via off
forwarded_for off
request_header_access All allow all

# T·∫Øt cache & log cho g·ªçn
cache deny all
access_log none
cache_log /dev/null
EOF

# ===== M·ªû PORT =====
if command -v ufw &>/dev/null; then
  ufw allow $PORT/tcp
else
  iptables -C INPUT -p tcp --dport $PORT -j ACCEPT 2>/dev/null || \
  iptables -I INPUT -p tcp --dport $PORT -j ACCEPT
fi

# ===== KH·ªûI ƒê·ªòNG =====
systemctl restart squid
systemctl enable squid

# ===== HI·ªÇN TH·ªä K·∫æT QU·∫¢ =====
echo
echo "‚úÖ HTTP PROXY NO-AUTH ƒë√£ c√†i xong!"
echo "üìå Proxy (IP:PORT): $IP:$PORT"
echo "$IP:$PORT" > /root/http_proxy_noauth.txt
