#!/bin/bash

# ThÃ´ng tin máº·c Ä‘á»‹nh
PORT=443
USERNAME="t1"
PASSWORD="t2"
INTERFACE=$(ip route get 1 | awk '{print $5; exit}')
IP=$(curl -s https://api.ipify.org)

# CÃ i Ä‘áº·t gÃ³i cáº§n thiáº¿t
apt update
apt install -y curl dante-server

# Táº¡o user
useradd -M -s /usr/sbin/nologin "$USERNAME"
echo "$USERNAME:$PASSWORD" | chpasswd

# Táº¡o file cáº¥u hÃ¬nh Dante
cat <<EOF > /etc/danted.conf
logoutput: /var/log/danted.log
internal: 0.0.0.0 port = $PORT
external: $INTERFACE
method: username
socksmethod: username
user.privileged: root
user.notprivileged: nobody
user.libwrap: nobody

client pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
  log: connect disconnect
}

socks pass {
  from: 0.0.0.0/0 to: 0.0.0.0/0
  command: connect
  log: connect disconnect
}
EOF

# Má»Ÿ port náº¿u dÃ¹ng UFW
if command -v ufw &> /dev/null; then
  ufw allow $PORT/tcp
else
  iptables -C INPUT -p tcp --dport $PORT -j ACCEPT 2>/dev/null || \
  iptables -I INPUT -p tcp --dport $PORT -j ACCEPT
fi

# Khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥
systemctl restart danted
systemctl enable danted

# Hiá»ƒn thá»‹ & lÆ°u káº¿t quáº£
PROXY="$IP:$PORT:$USERNAME:$PASSWORD"
echo
echo "âœ… SOCKS5 Proxy Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t thÃ nh cÃ´ng!"
echo "-------------------------------------------"
echo "  IP      : $IP"
echo "  Port    : $PORT"
echo "  Username: $USERNAME"
echo "  Password: $PASSWORD"
echo "-------------------------------------------"
echo "ðŸ“Œ Dáº¡ng Ä‘áº§y Ä‘á»§ Ä‘á»ƒ copy: $PROXY"
echo "$PROXY" > /root/socks5_proxy.txt
